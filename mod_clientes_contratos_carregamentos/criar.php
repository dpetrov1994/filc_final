<?phpif(!isset($included_from_file)) {    include('../_template.php');}include "../mod_clientes_contratos_carregamentos/.cfg.php";$content=file_get_contents("criar.tpl");$content=str_replace("_descricao_","",$content);/**Preenchimento dos itens do formulário **/if(!isset($included_from_file)) {    include("_criar_editar_detalhes.php");}/**FIM Preenchimento dos itens do formulário **/if(isset($_GET['get_form'])){    print $content;    die();}if(isset($_POST['submit'])){    $erros="";    $colunas="";    $valores="";    $scripts="";    if(isset($_FILES['file'])) {        $_POST['foto'] = carregar_foto($_FILES['file'], $cfg_tamanhoMaxUpload);    }    $id_cliente=$db->escape_string($_POST['id_cliente']);    $id_contrato=$db->escape_string($_POST['id_contrato']);    $_POST['balanco_anterior']=0;    $nome_contrato="";    $sql="select * from clientes_contratos where id_contrato = '$id_contrato'";    $result=runQ($sql,$db,"SELECT balanco anterior");    while ($row = $result->fetch_assoc()) {        $_POST['balanco_anterior']=$row['segundos_restantes'];        $nome_contrato=$row['nome_contrato'];    }    $nome_cliente="";    $sql2 = "select * from srv_clientes where id_cliente='" .$id_cliente ."'";    $result2 = runQ($sql2, $db, 0);    while ($row2 = $result2->fetch_assoc()) {        $nome_cliente = $row2['OrganizationName'];    }    $msg_not=$_POST['segundos']."".$_POST['unidade']." ao contrato [$nome_contrato] do cliente $nome_cliente";    if($_POST['unidade']=="h"){        $_POST['segundos']=$_POST['segundos']*60*60;    }elseif($_POST['unidade']=="m"){        $_POST['segundos']=$_POST['segundos']*60;    }    if(!is_numeric($_POST['segundos'])){        $erros.="Valor inserido em segundos tem de ser um número";    }    $return=colunas_valores_criar($_POST,$db,$itensIgnorar,$itensObrigatorios,$subModulo,$colunaParent,$idParent=0);    $erros=$return['erros'];    $colunas=$return['colunas'];    $valores=$return['valores'];    /**Validação de itens adicionais**/    if($_SESSION['tecnico']==1){        $titulo=cortaNome($_SESSION['nome_utilizador'])." adicionou $msg_not";        notificar($db,$titulo,"clientes_contratos","contrato",$id_contrato,"/mod_clientes_contratos/detalhes.php?id=$id_contrato",[$_SESSION['cfg']['id_utilizador_notificar']]);    }    /**FIM validação de itens adicionais**/    if($erros==""){        $sql="insert into $nomeTabela ($colunas,id_criou,created_at) values ($valores,'".$_SESSION['id_utilizador']."','".current_timestamp."')";        $result=runQ($sql,$db,"INSERT");        $insert_id=$db->insert_id;        /**Operações adicionais que necessitem do $insert_id **/        $segundos_adicionar=$db->escape_string($_POST['segundos']);        if(is_numeric($segundos_adicionar)){            $sql="update clientes_contratos set segundos_restantes = (segundos_restantes + ($segundos_adicionar)) where id_cliente='$id_cliente' and id_contrato='$id_contrato'";            $result=runQ($sql,$db,"atualizar segundos no contrato");        }        /**FIM perações adicionais que necessitem do $insert_id **/        $sql="select * from $nomeTabela where id_$nomeColuna = $insert_id";        $result=runQ($sql,$db,"SELECT INSERTED");        while ($row = $result->fetch_assoc()) {            $array_log=json_encode($row);            criarLog($db,$nomeTabela,"id_$nomeColuna",$insert_id,"Registo Criado",$array_log);        }        if(isset($_POST['form-ajax'])){            print 1;            $db->close();            die();        }        $location="detalhes.php$addUrl&cod=3";        if($subModulo==0){            $location.="&id=$insert_id";        }else{            $location.="&subItemID=$insert_id";        }        if(isset($_GET['goTo'])){            $location=$_GET['goTo']."&cod=1";        }    }else{        $erros.=" Falta de dados para processar pedido.";        $location="criar.php$addUrl&cod=2&erro=$erros";        if(isset($_GET['goTo'])){            $location=$_GET['goTo']."&cod=2&erro=$erros";        }    }    if(!isset($included_from_file)){        header("location: $location");    }}if(!isset($included_from_file)) {    $pageScript = '<script src="criar.js"></script>';    include('../_autoData.php');}